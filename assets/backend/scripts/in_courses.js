$(function(){iscatexists(),$("#new_course").click(function(){$("#new_course_panel").slideToggle()}),$("#cancel").click(function(){$("#courseform").validate().resetForm(),$("#new_course_panel").slideToggle(),$("#reg").val("Register"),$("#reg").attr("selid",-1)}),$.validator.setDefaults({errorClass:"help-block",highlight:function(e){$(e).closest(".form-group  ").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group ").removeClass("has-error")}}),$.validator.addMethod("pattern",function(e,t,a){return!!this.optional(t)||("string"==typeof a&&(a=new RegExp("^(?:"+a+")$")),a.test(e))},"Invalid input information."),$("#newcatform").validate({rules:{newcatname:{required:!0}},messages:{newcatname:{required:"Please enter the course name ."}}}),$("#newcourseform").validate({rules:{catselname:{required:!0},newcoursename:{required:!0}},messages:{name:{required:"Please enter  the course name"},category:{required:"Select the course category"}}}),$("#eligibility").wysihtml5({toolbar:{"font-styles":!1,emphasis:!1,lists:!0,html:!1,link:!1,image:!1,color:!1,blockquote:!1}}),loadselectcategory(),loadcategory(),loadlevel(),loadcourse(),newcourse(),savecourse(),newcategory(),$("#category").change(function(){var e=$("#category").val();loadcourses(e)}),$("#addnewcourse").click(function(){loadselectcategory()})}).ajaxStart(function(){Pace.restart()});var iscatexists=function(){$("#newcatname").keyup(function(){var e=$("#newcatname").val();$.post(site_url+"Institute/isCategoryexist",{data:e},function(e){if(0==e.error)var t=e.content.map(function(e){return e.categoryname});else t="no colleges found";$("#newcatname").autocomplete({source:t})})})},loadcategory=function(){return $.post(site_url+"Institute/getCourseCategory",function(e){t="";if("0"===e.iserror){var t='<option value="">SELECT CATEGORY</option>',a=e.category;for(var o in a){var s=a[o];t+='<option value="'+s.id+'" >'+s.categoryname+"</option>"}}$("#category").html(t)},"json")},loadselectcategory=function(){return $.post(site_url+"Institute/getCourseCategory",function(e){t="";if("0"===e.iserror){var t='<option value="">SELECT CATEGORY</option>',a=e.category;for(var o in a){var s=a[o];t+='<option value="'+s.id+'" >'+s.categoryname+"</option>"}}$("#catselname").html(t)},"json")},loadcourses=function(e){return $.post(site_url+"Institute/getCoursesbycategory",{cat:e},function(e){var t='<option value="">SELECT COURSE</option>';if("0"===e.iserror){var a=e.courses;for(var o in a){var s=a[o];t+='<option value="'+s.cid+'" >'+s.name+"</option>"}}$("#name").html(t)},"json")},loadlevel=function(){return $.post("Institute/getCourseLevel",function(e){var t='<option value="">SELECT COURSE LEVEL</option>';if("0"===e.iserror){var a=e.levels;for(var o in a){var s=a[o];t+='<option value="'+s.level+'" >'+s.level+"</option>"}}$("#level").html(t)},"json")},savecourse=function(){$("#courseform").validate({ignore:":hidden:not(textarea)",rules:{name:{required:!0},type:{required:!0}},messages:{name:{required:"Please enter course name."},type:{required:"Please select course type"}}}),$("#courseform").on("submit",function(e){if(e.preventDefault(),!$("#courseform").valid())return!1;if("Register"===$("#reg").val()){var t=$("#courseform").serialize();$.post(site_url+"Institute/createCourse",t,function(e){$("#custom_message").html(e.message),$("#myModal").modal({backdrop:"static",keyboard:!1})}).done(function(){loadcourse(1)})}else if("Update"===$("#reg").val()){var a=$("#courseform").serializeArray();a.push({name:"couid",value:$("#reg").attr("selid")}),$.post(site_url+"Institute/saveCourse",a,function(e){$("#custom_message").html(e.message),$("#myModal").modal({backdrop:"static",keyboard:!1})}).done(function(){loadcourse(1)}),$("#reg").val("Register"),$("#reg").attr("selid","-1")}$("#courseform")[0].reset(),$("#new_course_panel").slideToggle()})},loadcourse=function(e){var t=1,a="",o=$("#course_term").val();void 0!==o&&""!==o&&(a=o),void 0!==e&&(t=e),$.post(site_url+"Institute/getCourseByPage",{course:a,page:t},function(e){var t="";if(0==e.iserror){var a=e.courses;for(var o in a){var s=a[o],r="";if("1"===s.isavailable&&(r="checked"),t+='<div class="panel box">',t+='<div class="box-header with-border">',t+='<h4 class="box-title">',t+='<a data-toggle="collapse" style="color: #373b42" data-parent="#accordion" href="#collapse'+s.couid+'" aria-expanded="false" class="collapsed">',t+=s.name,t+="</a>",t+="</h4>",null!=s.feesstructure)var l="updated";else l="Upload fee structure";t+='<div class="pull-right"><label><input type="checkbox" class="minimal"  value="'+s.couid+'" name="isavailable" id="isavailable"  '+r+"> Is Seat Available </label>&nbsp;",t+='&nbsp;&nbsp;<button type="button"  class="btn btn-xs bg-gray-active" onclick="getseat('+s.couid+')"><i class="fa fa-graduation-cap"></i> Seat status</button>',t+='&nbsp;&nbsp;<button type="button"  class="btn btn-xs btn-primary" id="feestr" onclick="uploadfeestructure('+s.couid+');"><i class="fa fa-cloud-upload"></i>&nbsp;'+l+"</button>",t+='&nbsp;&nbsp;<button type="button"  class="btn btn-xs btn-warning" onclick="getcourse('+s.couid+')"><i class="fa fa-pencil"></i> Edit</button>',t+='&nbsp;&nbsp;<button type="button"  class="btn btn-xs btn-danger" onclick="deletecourse('+s.couid+')"><i class="fa fa-trash"></i> Delete</button></div>',t+="</div>",t+='<div id="collapse'+s.couid+'" class="panel-collapse collapse" aria-expanded="false" style="height:0px;">',t+='<div class="box-body">',t+='<div class="row">',t+='<div class="col-xs-12  col-sm-12 col-md-12 col-lg-12">  ',t+='<div class="col-xs-12  col-sm-12 col-md-12 col-lg-4 table-responsive">',t+='<table class="table table-striped">',t+="<tbody>",t+="<tr><th>Category</th><td>"+s.categoryname+"</td></tr>",t+="<tr><th>Shortname</th><td>"+s.shortname+"</td></tr>",t+="<tr><th>Course type</th><td>"+s.type+"</td></tr>",t+="<tr><th>Level</th><td>"+s.level+" </td></tr>",t+="<tr><th>Scheme</th><td>"+s.scheme+" </td></tr>";var c="Currently not added";null!=s.feesstructure&&(c='<a target="_blank" href="'+e.url+s.feesstructure+'">view fee structure</a>'),t+="<tr><th>Fee structure</th><td>"+c+"</td></tr>",t+="<tr><th>Total Seats</th><td>"+s.totalseats+"</td></tr>",t+="<tr><th>Available Seats</th><td>"+s.seats+"</td></tr>",t+="<tr><th>Duration</th><td>"+s.duration+"</td></tr>",t+="<tr><th>Total Fees</th><td> Rs."+s.fees+"/-</td></tr>",t+="</tbody>",t+="</table>",t+="</div>",t+='<div class="col-xs-12  col-sm-12 col-md-12 col-lg-8 invoice-col text-justify">',t+="<h5><b>Eligibility Criteria</b></h5>",t+=s.eligibility+"</div>",t+='<div class="col-xs-12  col-sm-12 col-md-12 col-lg-8 invoice-col text-justify">',t+="<h5><b>Short Details</b><h5>",t+=s.details+"</div>",t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="</div>"}var i="",n=e.page_count;i+=' <li><a  onclick="loadcourse(1)">«</a></li>';for(var u=1;u<=n;u++)i+='<li><a onclick="loadcourse('+u+')">'+u+"</a></li>";i+='<li><a  onclick="loadcourse('+n+')">»</a></li>',$("#course_page").html(i)}else t+="<h2>Sorry No uploaded course found at server</h2>",$("#course_page").html("");$("#accordion").html(t)},"json").done(function(){$('input[type="checkbox"].minimal, input[type="radio"].minimal').iCheck({checkboxClass:"icheckbox_flat-blue"}),$(".minimal").on("ifChanged",function(e){var t=0;!0===e.currentTarget.checked&&(t=1);var a={couid:e.currentTarget.value,isavailable:t};$.post("Institute/updateAvalability",a,function(e){$("#custom_message").html(e.message),$("#myModal").modal({backdrop:"static",keyboard:!1})})})})},getcourse=function(e){$.post("Institute/getCourseById",{id:e},function(t){$("#shortname").val(t.courses.shortname),$("#category").val(t.courses.category_id),loadcourses($("#category").val()),$("#name").val(t.courses.cid),$("#scheme").val(t.courses.scheme),$("#level").val(t.courses.level),$("#type").val(t.courses.type),$("#fees").val(t.courses.fees),$("#totalseats").val(t.courses.totalseats),$("#seats").val(t.courses.seats),$("#duration").val(t.courses.duration),$("#details").val(t.courses.details),$("iframe").contents().find(".wysihtml5-editor").html(t.courses.eligibility),$("#reg").val("Update"),$("#reg").attr("selid",e),!1===$("#new_course_panel").is(":visible")&&$("#new_course_panel").slideToggle()},"json")},deletecourse=function(e){!0===confirm("Are you sure!...")&&$.post("Institute/deleteCourse",{id:e},function(e){$("#custom_message").html(e.message),$("#myModal").modal({backdrop:"static",keyboard:!1}),loadcourse(1)},"json")},getseat=function(e){$.post("Institute/getseat",{id:e},function(t){seat=t.seat;for(var a in seat){var o=seat[a];$("#seatupdate").val(o.seats)}$("#seatsubmit").unbind().on("click",function(){var t=$("#seatupdate").val();$.post("Institute/Updateseat",{id:e,seatcount:t},function(e){$("#custom_message").html(e.message),$("#myModal").modal({backdrop:"static",keyboard:!1})})})}).done(function(){$("#seatupdateModal").modal({backdrop:"static",keyboard:!1})})},newcategory=function(){$("#catsubmit").on("click",function(e){if(e.preventDefault(),!$("#newcatform").valid())return!1;var t=$("#newcatname").val();$.post(site_url+"Institute/savenewcourse",{category:t},function(e){$("#newcatname").val(""),loadcategory(),0==e.error&&($("#custom_message").html(e.message),$("#myModal").modal({backdrop:"static",keyboard:!1})),1==e.error&&($("#custom_message").html(e.message),$("#myModal").modal({backdrop:"static",keyboard:!1}))})}),loadcategory()},newcourse=function(){$("#cousubmit").on("click",function(e){if(e.preventDefault(),!$("#newcourseform").valid())return!1;var t=$("#catselname").val(),a=$("#newcoursename").val();$.post(site_url+"Institute/savecoursebycollege",{category:t,course:a},function(e){$("#catselname").val(""),$("#newcoursename").val(""),loadcategory(),$("#custom_message").html(e.message),$("#myModal").modal({backdrop:"static",keyboard:!1})})})},uploadfeestructure=function(e){$("#feefile").trigger("click"),savefeestructure(e)},savefeestructure=function(e){$("#feefile").change(function(t){$("#couid").val(e),t.preventDefault();var a=new FormData(document.getElementById("feeform"),document.getElementById("couid"));$.ajax({url:site_url+"Institute/uploadFeestructure",type:"POST",data:a,processData:!1,contentType:!1,enctype:"multipart/form-data",success:function(e){$("#custom_message").html(e.message),$("#myModal").modal({backdrop:"static",keyboard:!1})}})})};