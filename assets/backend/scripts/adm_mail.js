$(function(){$("#searchmail").on("keyup",function(){getmail(1)}),$.validator.setDefaults({errorClass:"help-block",highlight:function(e){$(e).closest(".form-group  ").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group ").removeClass("has-error")}}),$.validator.addMethod("pattern",function(e,a,l){return!!this.optional(a)||("string"==typeof l&&(l=new RegExp("^(?:"+l+")$")),l.test(e))},"Invalid input information."),$("#composeemail").wysihtml5({toolbar:{"font-styles":!0,emphasis:!0,lists:!0,html:!0,link:!0,image:!1,color:!1,blockquote:!0}}),$("#mailmsg2").wysihtml5({toolbar:{"font-styles":!0,emphasis:!0,lists:!0,html:!0,link:!0,image:!1,color:!1,blockquote:!0}}),$('input[type="checkbox"].minimal, input[type="radio"].minimal').iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue"}),getcollegelist(),sendmailbox(),sendmultiplemailbox(),getmail(1)});var getcollegelist=function(){$.post("Administrator/getcollegecategorylist",function(e){var a="";if(0===e.iserror){var l=e.content;for(var i in l){var t=l[i];a+="<label>",a+='<input id="categorylist" name="categorylist" value="'+t.category+'" type="checkbox" class="minimal" >',a+='<span style="padding:5px;">'+t.category+"</span>",a+="</label>",a+="<br/>"}}else a+="No value found on server";$("#collegelist").html(a),$('input[type="checkbox"].minimal, input[type="radio"].minimal').iCheck({checkboxClass:"icheckbox_flat-blue"}),$checks=$('input[type="checkbox"].minimal'),$checks.on("ifChanged",function(){var e=$checks.filter(":checked").map(function(){return this.value}).get().join(" ");$("#mailto2").val(e)})})},sendmailbox=function(){$("#mailboxcustom").validate({rules:{mailto:{required:!0},mailsubject:{required:!0},composeemail:{required:!0},mailtocollege:{required:!0}},messages:{mailto:{required:"Please enter reciepient emailid."},mailsubject:{required:"Please provide any subject"},composeemail:{required:"Please type your message"},mailtocollege:{required:"Please type college name"}}}),$("#mailboxcustom").on("submit",function(e){if(e.preventDefault(),!$("#mailboxcustom").valid())return!1;$("#singlesendbtn").html("sending"),$("#singlesendbtn").prop("disabled",!0);var a=$("#mailto").val(),l=$("#mailtocollege").val(),i=$("#mailsubject").val(),t=$("#mailmsg").val();$.post(site_url+"Administrator/sendcustommail",{to:a,mailtocollege:l,mailsubject:i,message:t},function(e){$("#singlesendbtn").html("Send"),$("#singlesendbtn").prop("disabled",!1),$("#mailto").val(""),$("#mailtocollege").val(""),$("#mailsubject").val(""),$("#mailmsg").val(""),$("#custom_heading").html("Server response"),$("#custom_message").html(e.message),$("#alertmodal").modal({backdrop:"static",keyboard:!1})})})},sendmultiplemailbox=function(){$("#mailboxcustom2").validate({rules:{mailto2:{required:!0},mailsubject2:{required:!0},mailsubject2:{required:!0}},messages:{mailto:{required:"Please enter reciepient emailid."},mailsubject:{required:"Please provide any subject"},mailsubject2:{required:"Please type your message"}}}),$("#mailboxcustom2").on("submit",function(e){if(e.preventDefault(),!$("#mailboxcustom2").valid())return!1;$("#mulsendbtn").html("sending"),$("#mulsendbtn").prop("disabled",!0);var a=[];$.each($("input[name='categorylist']:checked"),function(){a.push($(this).val())});$("#mailto2").val();var l=$("#mailsubject2").val(),i=$("#mailmsg2").val();$.post("Administrator/sendmultiplemail",{to:a,mailsubject:l,message:i},function(e){$("#mulsendbtn").html("Send"),$("#mulsendbtn").prop("disabled",!1),$("#mailto2").val(""),$("#mailsubject2").val(""),$("#composeemail2").val(""),$("#custom_heading").html("Server response"),$("#custom_message").html(e.message),$("#alertmodal").modal({backdrop:"static",keyboard:!1})})})},getmail=function(e){var a=$("#searchmail").val();$.post("Administrator/getallmails",{page:e,search:a},function(e){var a=0;if(0==e.iserror){var l="",i=e.value;for(var t in i){a++;var o=i[t];l+="<tr>",l+="<td>"+a+"</td>",l+='<td><button type="button" class="btn btn-default btn-sm" onclick="deletemail('+o.id+')"><i class="fa fa-trash-o"></i></button></td>',l+='<td class="mailbox-subject"><b>'+o.collegename+"</b>",l+=' <td class="mailbox-name"><a href="javascript:void(0)" onclick="mailreadpage('+o.id+')">'+o.collegeemail+"</a></td>",l+='<td class="mailbox-subject"><b>'+o.subject+"</b>",l+="</td>",l+="</td>",l+='<td class="mailbox-subject">'+o.message+"</td>",l+='<td class="mailbox-date">'+o.date+"</td>",l+="</tr>"}$("#allmailbox").html(l);var s="",m=e.page_count;s+=' <ul class="pagination pagination-sm  pull-right" style="margin:0px;"><li><a  href="javascript:void(0);" onclick="getmail(1)">«</a></li>';for(var r=1;r<=m;r++)s+=' <li><a  href="javascript:void(0);" onclick="getmail('+r+')">'+r+"</a></li>";s+='<li><a href="javascript:void(0);"  onclick="getmail('+m+')">»</a></li>',$("#mailpage").html(s)}1===e.iserror&&$("#allmailbox").html("No information found on server")}),$("#mailrefresh").click(function(){getmail(1)})},mailreadpage=function(e){$.post("Administrator/getmailcontent",{id:e},function(e){if(0===e.iserror){var a=e.value;for(var l in a){var i=a[l];$("#collegemailname").html(i.collegename),$("#frommail").html(i.collegeemail),$("#maildate").html(i.date),$("#mailsubject").html(i.subject),$("#mailcontent").html(i.message),0==i.isiview&&$("#mailstatus").html("&#x2715; not read"),1==i.isiview&&$("#mailstatus").html("&#10003; read")}}}),$("#collegeform").modal({keyboard:!1,backdrop:"static"})},deletemail=function(e){1==confirm("Are you sure")&&$.post("Administrator/deletemailbyid",{id:e},function(e){getmail(1),$("#custom_heading").html("Server response"),$("#custom_message").html(e.message),$("#alertmodal").modal({backdrop:"static",keyboard:!1})})};